pipeline {
    agent any
    tools {
                // Install the Maven version configured as "M2_HOME" and add it to the path.
                maven "M2_HOME"
            }

    stages {
      
        stage('Mvn-VERSION') {
            steps {
                sh """mvn -version"""
                  }
                        }

        stage('Mvn-ClEAN') {
            steps {
                 sh """mvn clean"""
                    }
                            }
        stage('Mvn-COMPILE') {
            steps {
                  sh """mvn compile"""
                   }
                              }

                  stage('Mvn-Build') {
                              steps {
                                 script{

                                    sh """mvn -Dmaven.test.failure.ignore=true clean package"""
                                }

                              }
                    }
                   
        stage('Mvn-SONARQUBE') {
            steps {
            withSonarQubeEnv(installationName: 'sq2')
                {sh """mvn sonar:sonar"""}

                   }
                              }
            stage('Upload Jar To NEXUS') {
                     environment {

                        NEXUS_CREDENTIAL_ID = "Nexus-Credential"}

                         steps {
                                script{

                                       def mavenPom = readMavenPom file: 'pom.xml'
                                       nexusArtifactUploader(
                                                nexusVersion:"nexus3",
                                                protocol:"http",
                                                nexusUrl:"192.168.1.244:8081",
                                                groupId: 'tn.esp',
                                                repository:"Team1-Devops",



                                        artifacts:
                                            [
                                                [ artifactId: 'team1',
                                                  classifier: '',
                                                  file: "target/team1-${mavenPom.version}.jar",
                                                  type: 'jar'
                                                 ]
                                            ],


                                          version: "${mavenPom.version}",


                                          )

                                        }

                                        sh """ mvn deploy """
                                 }
                             }






    }
   }
